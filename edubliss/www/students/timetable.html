{% extends "templates/layout.html" %}

{% block title %}
{{ _("Student Report Card") }}
{% endblock %}

{% block headnav_link %}
    {% include "templates/includes/headnav/edu_headnav3.html" %}
{% endblock %}

{% block content %}
<style>

    @media screen {
    .print-format-gutter {
      background-color: #ddd;
      padding: 15px 0px;
    }
    .print-format {
      background-color: white;
      box-shadow: 0px 0px 9px rgba(0,0,0,0.5);
      max-width: 8.3in;
      min-height: 11.69in;
      padding: 0.75in;
      margin: auto;
    }

    .print-format.landscape {
      max-width: 11.69in;
      padding: 0.2in;
    }

    .page-break {
      padding: 30px 0px;
      border-bottom: 1px dashed #888;
    }

    .page-break:first-child {
      padding-top: 0px;
    }

    .page-break:last-child {
      border-bottom: 0px;
    }

    /* mozilla hack for images in table */
    body:last-child .print-format td img {
      width: 100% !important;
    }

    @media(max-width: 767px) {
      .print-format {
        padding: 0.2in;
      }
    }
  }

  @media print {
    .print-format p {
      margin-left: 1px;
      margin-right: 1px;
    }
  }

  .data-field {
    margin-top: 5px;
    margin-bottom: 5px;
  }

  .data-field .value {
    word-wrap: break-word;
  }

  .important .value {
    font-size: 120%;
    font-weight: bold;
  }

  .important label {
    line-height: 1.8;
    margin: 0px;
  }

  .table {
    margin: 10px 0px;
  }

  .square-image {
    width: 100%;
    height: 0;
    padding: 50% 0;
    background-size: contain;
    /*background-size: cover;*/
    background-repeat: no-repeat !important;
    background-position: center center;
    border-radius: 4px;
  }

  .print-item-image {
    object-fit: contain;
  }

  .pdf-variables,
  .pdf-variable,
  .visible-pdf {
    display: none !important;
  }

  .print-format {
    font-size: 7pt;
    font-family: "Helvetica Neue", Helvetica, Arial, "Open Sans", sans-serif;
    -webkit-print-color-adjust:exact;
  }

  .page-break {
    page-break-after: always;
  }

  table.no-border, table.no-border td {
    border: 0px;
  }

  .print-format label {
    /* wkhtmltopdf breaks label into multiple lines when it is inline-block */
    display: block;
  }

  .print-format img {
    max-width: 100%;
  }

  .print-format table td > .primary:first-child {
    font-weight: bold;
  }

  .print-format td, .print-format th {
    vertical-align: middle !important;
    padding: 3px !important;
  }

  .print-format p {
    margin: 3px 0px 3px;
  }

  table td div {

    /* needed to avoid partial cutting of text between page break in wkhtmltopdf */
    page-break-inside: avoid !important;

  }

  /* hack for webkit specific browser */
  @media (-webkit-min-device-pixel-ratio:0) {
    thead, tfoot { display: table-row-group; }
  }

  [document-status] {
    margin-bottom: 5mm;
  }

  .signature-img {
    background: #fff;
    border-radius: 3px;
    margin-top: 5px;
    max-height: 150px;
  }

  .stuphoto-img {
    max-width: 70px;
    height: 80px;
/*    border: 2px solid #0c2c42;*/
    border-radius: 6px;
  }

  .print-heading {
    text-align: right;
    text-transform: uppercase;
    color: #666;
    padding-bottom: 20px;
    margin-bottom: 20px;
    border-bottom: 1px solid #d1d8dd;
  }

  .print-heading h2 {
    font-size: 24px;
  }

  .print-format th {
    background-color: #a0d0db !important;
    border-bottom: 0px !important;
  }

  /* modern format: for-test */

  .pbi_avoid {
    page-break-inside: avoid !important;
  }

  .pb_before {
    page-break-before: always !important;
  }

  .pdf-header {
    display: inline-block;
  }

  .text-primary-header {
      color: #010a4f; /* or any warning color you prefer */
  }

  .text-primary-head {
      color: #043f80; /* or any warning color you prefer */
  }

  .text-primary-rep {
      color: #3532ed; /* or any warning color you prefer */
  }

  .text-secondary {
      color: #610623; /* or any warning color you prefer */
  }

    .performance-title {
      text-align: center;
    }

/* Break slot column */
.break-slot {
  background-color: #f4f4f4;
  font-style: italic;
  color: #555;
}

/* Break cell content */
.break-label {
  font-size: 11px;
  font-weight: bold;
  color: #888;
}

/* Example class schedule colors */
.math { background-color: #e1f0ff; }
.english { background-color: #fff5e1; }
.science { background-color: #e1ffe4; }
.cancelled { background-color: #ffe1e1; }


</style>

<main class="grow content pt-5 {% if 'Student' in user_roles and not 'Academics User' in user_roles %}bg-gray-100{% endif %}" id="content" role="content">
 <!-- begin: container -->
 <div class="container-fixed" id="content_container">
 </div>
 <!-- end: container -->
  {% if "Academics User" in user_roles or "Parent" in user_roles %}
  {% include "templates/includes/student_header.html" %}

  {% include "templates/includes/student_nav.html" %}
  {% endif %}
 <!-- begin: container -->
 <div class="container-fixed">
  <div class="flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5">
   <div class="flex flex-col justify-center gap-2">
    {% if sections %}   
    <h1 class="text-xl font-semibold leading-none text-primary">
     Class Timetable
    </h1>
    <div class="flex items-center flex-wrap gap-1.5 font-medium">
     <span class="text-md text-gray-600">
       {{ sections.program_section or ""}} 
     </span>
    </div>
    {% endif %}
   </div>
  </div>
 </div>
 <!-- end: container -->
 <!-- Container -->
 <div class="container-fixed">
  <div class="flex flex-col items-stretch gap-5 lg:gap-7.5">
   <div class="flex flex-wrap items-center gap-5 justify-between">
    <h3 class="text-md text-gray-900 font-medium">
    </h3>
    <div class="flex items-center gap-5">
     <div class="flex items-center gap-2.5">
     </div>
    </div>
   </div>
    
    <div class="flex grow justify-center">
    </div>
  </div>
 </div>
 <!-- End of Container -->

{% set sections = sections or {} %}
{% set timetable_slots = timetable_slots or [] %}
{% set days = days_order or [] %}
{% set timetable_map = timetable_map or {} %}

{% if timetable_slots and days %}
  <div class="container-fixed" id="content_container">
    <div class="grid gap-5 lg:gap-7.5">
      <div class="card">
        <div class="card-body lg:py-7.5">

          <p class="performance-title">
            <b class="text-secondary" style="font-size: 12pt">
              {{ sections.program_section if sections.program_section is defined else (sections if sections is string else '') }} Timetable
            </b>
          </p>

          <table width="100%" style="margin:0; padding:0; border:1px solid #043f80; border-collapse:collapse;">
            <thead>
              <tr>
                <th class="text-left bg-danger-light" style="border-right:1px solid #043f80; padding:6px; width:12%;">Day</th>
                {% for slot in timetable_slots %}
                  <th class="text-center bg-success-light" 
                      style="border-right:1px solid #043f80; padding:6px; width:{{ 100 / (timetable_slots|length + 2) }}%;">
                    <span class="text-primary-head text-2sm">
                      {% if slot.label %}{{ slot.label or '' }}<br>{% endif %}
                      {{ slot.start_time or '' }} - {{ slot.end_time }}
                    </span>
                  </th>
                {% endfor %}
              </tr>
            </thead>

            <tbody>
              {% if days|length == 0 %}
                <tr><td colspan="{{ 2 + (timetable_slots|length) }}" class="text-center text-2sm">No schedules found.</td></tr>
              {% else %}
                {% for day in days %}
                  <tr>
                    <td class="left text-xs bg-danger-light" style="border-top:1px solid #043f80; border-right:1px solid #043f80; padding:6px;"><b>{{ day }}</b></td>

                    {% set row = timetable_map.get(day, []) %}
                    {% for col_index in range(timetable_slots|length) %}
                      {% set slot = timetable_slots[col_index] %}
                      {% set cell = row[col_index] if row|length > col_index else None %}

                      <td class="text-center text-xs {% if slot.is_break %}break-slot{% endif %} {{ cell.class_schedule_color if cell and cell.class_schedule_color }}" 
                          style="border-top:1px solid #043f80; border-right:1px solid #043f80; padding:6px; min-width:80px;">
                        {% if slot.is_break %}
                          <div class="break-label">{{slot.label}}</div>
                        {% elif cell %}
                          <div style="font-weight:600; font-size:11px; color: {{ cell.class_schedule_color or '' }};">{{ cell.course_name | default(cell.course) | upper }}</div>
                          {% if cell.room %}<div style="font-size:10px;">Room: {{ cell.room }}</div>{% endif %}
                          {% if cell.instructor %}<div style="font-size:10px; color: red;">{{ cell.instructor }}</div>{% endif %}
                        {% else %}
                          <div style="color:#666; font-size:11px;">&nbsp;</div>
                        {% endif %}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              {% endif %}
            </tbody>
          </table>

        </div>
      </div>
    </div>
  </div>
{% else %}
  <div class="container-fixed" id="content_container">
    <div class="card"><div class="card-body">
      <p class="text-center">No timetable data available.</p>
    </div></div>
  </div>
{% endif %}

    </main>
{% endblock %}
